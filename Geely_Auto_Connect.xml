<?xml version='1.0' encoding='UTF-8' standalone='yes' ?>
<macrodroid>
    <macro name="Geely Start (Driver Mode)">
        <!-- Triggers: Bluetooth Conectado OU Tile clicado para Ligar -->
        <!-- Nota: Configure o Bluetooth para seu dispositivo 'Geely EX2' -->
        <trigger type="bluetooth_state" state="connected" device="Geely EX2" />
        <trigger type="quick_settings_tile" tile_number="1" state="toggle_on" />
        <condition type="power_connected" state="any" />
        
        <!-- 1. Feedback Visual e Configuração de Ambiente -->
        <action type="quick_settings_tile_state" tile_number="1" state="toggle_on" />
        <action type="brightness" value="100%" />
        <action type="volume_music" value="90%" />
        <action type="dnd" mode="priority" /> <!-- Não Perturbe Ativado -->

        <!-- 2. Garantir Shizuku (Motor) -->
        <action type="shell_command" command="sh /sdcard/Android/data/moe.shizuku.privileged.api/files/start.sh" use_shizuku="true" />
        <action type="wait" seconds="2" />
        
        <!-- 3. Iniciar Interface (Taskbar primeiro para garantir overlay) -->
        <action type="launch_app" package="com.farmerbb.taskbar" />
        <action type="wait" seconds="1" />
        
        <!-- 4. Ativar SecondScreen (Resolução) -->
        <action type="send_intent" action="com.farmerbb.secondscreen.LOAD_PROFILE" package="com.farmerbb.secondscreen.free">
            <extra name="profile_name" value="Geely EX2" />
        </action>
        <action type="wait" seconds="1" />

        <!-- 5. Lançar App de Trabalho (Ex: Uber/99/Waze) -->
        <action type="launch_app" package="com.ubercab.driver" />
        
        <action type="display_notification" title="Geely Driver Mode" text="Turno iniciado! Bom trabalho." />
    </macro>
    
    <macro name="Geely Stop (Cleanup & Rest)">
        <!-- Triggers: Bluetooth Desconectado OU Tile clicado para Desligar -->
        <trigger type="bluetooth_state" state="disconnected" device="Geely EX2" />
        <trigger type="quick_settings_tile" tile_number="1" state="toggle_off" />
        
        <!-- 1. Resetar Tile e Ambiente -->
        <action type="quick_settings_tile_state" tile_number="1" state="toggle_off" />
        <action type="brightness" value="-1" /> <!-- -1 = Brilho Automático -->
        <action type="volume_music" value="50%" />
        <action type="dnd" mode="all" /> <!-- Não Perturbe Desativado -->
        
        <!-- 2. Kill Switch (Limpeza Agressiva via Shell/Shizuku) -->
        <action type="shell_command" command="am force-stop com.farmerbb.taskbar
am force-stop com.ubercab.driver
am force-stop com.taxis99
am force-stop com.waze
am force-stop com.google.android.apps.maps
am force-stop com.spotify.music" use_shizuku="true" />
        
        <!-- 3. Desligar SecondScreen e Resetar Gráficos -->
        <action type="send_intent" action="com.farmerbb.secondscreen.TURN_OFF" package="com.farmerbb.secondscreen.free" />
        
        <!-- Reset do Android 15 (Mais seguro) -->
        <action type="shell_command" command="wm density reset
settings put global policy_control null" use_shizuku="true" />
        
        <action type="display_notification" title="Modo Descanso" text="Tudo limpo e apps fechados." />
    </macro>
</macrodroid>
